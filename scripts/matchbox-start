set -eu

SCRIPT_DIRECTORY=$(dirname "$0")
MATCHBOX_DIR=$SCRIPT_DIRECTORY/../project/matchbox
BIN_DIR=$SCRIPT_DIRECTORY/../bin

pushd $(pwd)

cd $MATCHBOX_DIR

# Build the matchbox binary
cargo build --bin matchbox

popd

sudo $MATCHBOX_DIR/target/debug/matchbox \
    --firecracker-path $BIN_DIR/firecracker \
    --kernel-image-path /tmp/vmlinux.bin \
    --root-fs-path /tmp/rootfs.ext4